---
title: "Service: sinks"
---

Sinks consume canonical JetStream events and persist them to storage backends.

## Entrypoints

- [`cmd/sink/clickhouse/main.go`](../reference/code/cmd/sink/clickhouse/main)
- [`cmd/sink/parquet/main.go`](../reference/code/cmd/sink/parquet/main)
  - Note: the ClickHouse sink currently consumes swap/trade subjects; candle materialization is handled by `cmd/candles`.

Package walkthrough: [`sinks/`](../reference/code/sinks)

## Entrypoints (wiring)

Both sink binaries follow the same structure:

1. Load a service config from environment variables.
2. Construct a long-running service object.
3. Install SIGINT/SIGTERM handling to cancel the context.
4. Call `Run(ctx)` and exit on error.

```go title="cmd/sink/clickhouse/main.go" file=<rootDir>/cmd/sink/clickhouse/main.go showLineNumbers
```

```go title="cmd/sink/parquet/main.go" file=<rootDir>/cmd/sink/parquet/main.go showLineNumbers
```

Full annotated entrypoints:

- [`cmd/sink/clickhouse/main.go`](../reference/code/cmd/sink/clickhouse/main)
- [`cmd/sink/parquet/main.go`](../reference/code/cmd/sink/parquet/main)
- Candle materialization: [`cmd/candles/main.go`](../reference/code/cmd/candles/main)

## Validation harness

```bash
make sink-e2e
```

Harness source: [`scripts/run_sink_e2e.sh`](../reference/code/scripts/run_sink_e2e)

## See also

- [NATS / JetStream design](../architecture/nats)
- [Storage (ClickHouse + Parquet)](../architecture/storage)
- [Ops: ClickHouse operations](../ops/clickhouse)
