---
title: Storage (ClickHouse + Parquet)
---

This repo ships two primary persistence sinks: ClickHouse and Parquet.

## ClickHouse

ClickHouse is used for query-heavy workloads and near-real-time analytics.

- Schemas live in [`ops/clickhouse/`](../reference/code/ops/clickhouse)
- Sink service entrypoint: [`cmd/sink/clickhouse/main.go`](../reference/code/cmd/sink/clickhouse/main)
- Writer implementation: [`sinks/clickhouse/`](../reference/code/sinks)

The core table schemas are committed in `ops/clickhouse/all.sql`:

```sql title="ops/clickhouse/all.sql (trades + candles excerpt)" file=<rootDir>/ops/clickhouse/all.sql#L1-L83 showLineNumbers
```

Full schema walkthrough: [`ops/clickhouse/all.sql`](../reference/code/ops/clickhouse/all)

### Current implementation note

- The ClickHouse sink service currently materializes swap/trade events into the `trades` table.
- Candle materialization is currently handled by the separate [`cmd/candles`](../reference/code/cmd/candles/main) materializer process (table name defaults to `candles`), while the `ohlcv_*` schemas in `ops/clickhouse/` represent the target analytics schema family.

## Parquet

Parquet is used for batch export / data lake compatible workflows.

- Sink service entrypoint: [`cmd/sink/parquet/main.go`](../reference/code/cmd/sink/parquet/main)
- Writer implementation: [`sinks/parquet/`](../reference/code/sinks)

## End-to-end validation

```bash
make sink-e2e
```

## See also

- [Ops: ClickHouse operations](../ops/clickhouse)
- [Ops: local dev](../ops/local-dev)
- [Service: sinks](../services/sinks)
