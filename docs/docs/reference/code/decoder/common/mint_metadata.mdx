---
title: "decoder/common/mint_metadata.go"
---

This page is an **annotated source reference**. Code blocks are imported from the repository at build time.

## What this file is

`decoder/common/mint_metadata.go` defines a small mint metadata model and a
pluggable lookup interface used by some decoders to:

- fetch token decimals
- determine canonical base/quote ordering using token symbols

It also includes a simple in-memory provider pre-populated with common Solana
tokens (useful for tests and local decoding).

## Why this file exists

Accurate swap normalization often requires:

- the correct decimal count per mint (to scale amounts)
- a consistent convention for base/quote ordering (e.g. `SOL/USDC` instead of `USDC/SOL`)

By abstracting “mint metadata lookup” behind an interface, decoders can work with:

- a stub provider in tests
- a real provider backed by on-chain RPC, token lists, or a metadata service in production

## Full source

```go title="decoder/common/mint_metadata.go" file=<rootDir>/decoder/common/mint_metadata.go showLineNumbers
```

## Walkthrough (by declaration)

### package common

```go title="package common" file=<rootDir>/decoder/common/mint_metadata.go#L1-L1 showLineNumbers
```

**What:** Declares shared decoder utilities for mint metadata and ordering rules.

**How:** Decoders call into this package to fetch decimals and choose base/quote orientation deterministically.

**Why:** Centralizing ordering/metadata logic prevents inconsistent pair orientation across different DEX decoders.

### imports

```go title="imports" file=<rootDir>/decoder/common/mint_metadata.go#L3-L6 showLineNumbers
```

**What:** Dependencies for concurrency and error formatting.

**How:** The in-memory provider uses an RW mutex and returns helpful errors via `fmt.Errorf`.

**Why:** Metadata lookups may be concurrent in decoders; correctness requires synchronization.

### type (MintMetadata)

**Symbols:** MintMetadata

```go title="type (MintMetadata)" file=<rootDir>/decoder/common/mint_metadata.go#L8-L14 showLineNumbers
```

**What:** Represents minimal metadata for a token mint.

**How:** Holds:

- mint `Address`
- human-friendly `Symbol` and `Name`
- `Decimals` for amount scaling

**Why:** Decoders need decimals to interpret raw integer amounts and often want symbols for canonical ordering rules.

### type (MintMetadataProvider)

**Symbols:** MintMetadataProvider

```go title="type (MintMetadataProvider)" file=<rootDir>/decoder/common/mint_metadata.go#L16-L27 showLineNumbers
```

**What:** Interface for mint metadata lookups.

**How:** Provides:

- `GetMintMetadata` (full metadata)
- `GetDecimals` (convenience)
- `CacheMintMetadata` (bulk preloading hook)

**Why:** Allows decoders to be written against a stable contract while swapping implementations (token list, RPC, cache, etc.).

### type (InMemoryMintMetadataProvider)

**Symbols:** InMemoryMintMetadataProvider

```go title="type (InMemoryMintMetadataProvider)" file=<rootDir>/decoder/common/mint_metadata.go#L29-L34 showLineNumbers
```

**What:** Simple thread-safe in-memory implementation of `MintMetadataProvider`.

**How:** Stores a `map[mintAddress]*MintMetadata` protected by an RW mutex.

**Why:** Useful as a stub in tests and as a lightweight implementation for local development.

### func NewInMemoryMintMetadataProvider

**Symbols:** NewInMemoryMintMetadataProvider

```go title="func NewInMemoryMintMetadataProvider" file=<rootDir>/decoder/common/mint_metadata.go#L36-L75 showLineNumbers
```

**What:** Constructs an in-memory provider preloaded with common Solana mints.

**How:** Initializes the map and inserts metadata entries for well-known tokens like wrapped SOL, USDC, USDT, and ORCA.

**Why:** Many decoder tests/fixtures involve these mints; preloading avoids repetitive setup and makes the stub immediately usable.

### func (*InMemoryMintMetadataProvider) GetMintMetadata

**Symbols:** GetMintMetadata

```go title="func (*InMemoryMintMetadataProvider) GetMintMetadata" file=<rootDir>/decoder/common/mint_metadata.go#L77-L88 showLineNumbers
```

**What:** Looks up metadata for a mint address.

**How:** Uses a read lock and returns an error when the mint is not in the map.

**Why:** Decoders depend on decimals/symbols for normalization; missing metadata should be an explicit failure in contexts where it is required.

### func (*InMemoryMintMetadataProvider) GetDecimals

**Symbols:** GetDecimals

```go title="func (*InMemoryMintMetadataProvider) GetDecimals" file=<rootDir>/decoder/common/mint_metadata.go#L90-L98 showLineNumbers
```

**What:** Convenience method returning only the decimals for a mint.

**How:** Delegates to `GetMintMetadata` and returns `metadata.Decimals`.

**Why:** Most decoding logic needs decimals more often than full metadata.

### func (*InMemoryMintMetadataProvider) CacheMintMetadata

**Symbols:** CacheMintMetadata

```go title="func (*InMemoryMintMetadataProvider) CacheMintMetadata" file=<rootDir>/decoder/common/mint_metadata.go#L100-L105 showLineNumbers
```

**What:** Bulk metadata preloading hook.

**How:** In this stub implementation it is a no-op.

**Why:** The interface anticipates a real provider that may fetch/cache metadata from external sources; keeping the method allows that upgrade without changing call sites.

### func (*InMemoryMintMetadataProvider) AddMintMetadata

**Symbols:** AddMintMetadata

```go title="func (*InMemoryMintMetadataProvider) AddMintMetadata" file=<rootDir>/decoder/common/mint_metadata.go#L107-L113 showLineNumbers
```

**What:** Adds or updates a mint metadata record.

**How:** Takes a write lock and sets `metadata[address] = record`.

**Why:** Primarily used by tests to extend the stub provider beyond the pre-populated mints.

### var (canonicalPriority)

**Symbols:** canonicalPriority

```go title="var (canonicalPriority)" file=<rootDir>/decoder/common/mint_metadata.go#L115-L120 showLineNumbers
```

**What:** Priority table for canonical base/quote ordering by token symbol.

**How:** Higher values represent “more canonical quote assets” (e.g. USDC outranks SOL).

**Why:** Using a stable priority ordering ensures consistent pair orientation across swaps and across DEXes.

### func DetermineBaseQuote

**Symbols:** DetermineBaseQuote

```go title="func DetermineBaseQuote" file=<rootDir>/decoder/common/mint_metadata.go#L122-L150 showLineNumbers
```

**What:** Determines which mint should be treated as base and which as quote.

**How:** The function:

1. Loads metadata for both mints from the provider.
2. Looks up symbol priorities.
3. Chooses:
   - when priorities differ: lower-priority mint becomes base, higher-priority mint becomes quote
   - when priorities tie: uses lexicographic ordering of mint addresses for determinism

**Why:** Canonical base/quote orientation makes downstream aggregation and querying much easier (you don’t want two markets `SOL/USDC` and `USDC/SOL` representing the same pool).

### func getPriority

**Symbols:** getPriority

```go title="func getPriority" file=<rootDir>/decoder/common/mint_metadata.go#L152-L157 showLineNumbers
```

**What:** Helper that resolves a symbol into its priority score.

**How:** Returns the symbol’s configured score or falls back to the `"default"` score.

**Why:** Keeps `DetermineBaseQuote` readable and centralizes fallback behavior.
