---
title: "decoder/meteora/proto.go"
---

This page is an **annotated source reference**. Code blocks are imported from the repository at build time.

## What this file is

`decoder/meteora/proto.go` projects the Meteora decoder’s `SwapEvent` into the
repository’s canonical protobuf message (`dex.sol.v1.SwapEvent`).

It is the bridge between “decoder-local structs” and “pipeline-wide protobuf
contracts”.

## Why this file exists

Downstream publishers and sinks operate on canonical protobuf messages so they
can be decoupled from decoder implementation details.

Keeping the conversion logic here:

- makes the mapping explicit and reviewable
- isolates protobuf dependencies from core decoding logic
- ensures all ingestion paths publish the same event schema

## Full source

```go title="decoder/meteora/proto.go" file=<rootDir>/decoder/meteora/proto.go showLineNumbers
```

## Walkthrough (by declaration)

### package meteora

```go title="package meteora" file=<rootDir>/decoder/meteora/proto.go#L1-L1 showLineNumbers
```

**What:** Declares the Meteora decoder package.

**How:** Adds a `ToProto()` method on `SwapEvent`.

**Why:** Method-based conversion keeps call sites concise and makes it easy to keep the canonical mapping in sync with the decoder model.

### imports

```go title="imports" file=<rootDir>/decoder/meteora/proto.go#L3-L3 showLineNumbers
```

**What:** Canonical protobuf contract for swap events.

**How:** Imports `dexv1.SwapEvent` from generated protobuf bindings.

**Why:** The rest of the pipeline publishes/consumes protobuf messages; conversion targets that schema.

### func (*SwapEvent) ToProto

**Symbols:** ToProto

```go title="func (*SwapEvent) ToProto" file=<rootDir>/decoder/meteora/proto.go#L5-L43 showLineNumbers
```

**What:** Converts a Meteora `SwapEvent` into the canonical protobuf `dexv1.SwapEvent`.

**How:** The method:

- returns `nil` for a nil receiver
- ensures `ProgramId` is non-empty (falls back to a known CPMM program ID)
- maps identifiers and metadata:
  - `ChainId = 501`
  - `Slot`, `Sig`, `ProgramId`, `PoolId`
  - canonical base/quote mint IDs and decimals (`MintBase`, `MintQuote`, `DecBase`, `DecQuote`)
  - fee bps and provisional flag
- maps amounts based on orientation:
  - when `BaseDecreased` is true → base out / quote in
  - otherwise → base in / quote out

**Why:** This mapping is what downstream publishers and sinks rely on; it standardizes how Meteora swaps appear in JetStream and storage.
