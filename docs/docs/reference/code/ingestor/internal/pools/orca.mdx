---
title: "ingestor/internal/pools/orca.go"
---

This page is an **annotated source reference**. Code blocks are imported from the repository at build time.

## What this file is

`ingestor/internal/pools/orca.go` contains low-level byte parsing helpers for
Orca Whirlpool pool accounts.

It defines:

- fixed offsets/length checks for fields inside the Whirlpool account layout
- an `OrcaPoolInfo` struct holding the subset of metadata needed for swap decoding
- `DecodeOrcaPool` to extract mints/vaults and fee rate from raw account data

## Why this file exists

The swap decoder needs stable pool metadata (token mints, vault addresses, fee
rate) to interpret token balance deltas and produce canonical swap events.

This file exists to:

- keep the “account layout knowledge” in one place
- avoid runtime dependencies on full Anchor decoding/IDL tooling
- support enrichment via account updates (`ingestor/decoder.HandleAccount`)

## Full source

```go title="ingestor/internal/pools/orca.go" file=<rootDir>/ingestor/internal/pools/orca.go showLineNumbers
```

## Walkthrough (by declaration)

### package pools

```go title="package pools" file=<rootDir>/ingestor/internal/pools/orca.go#L1-L1 showLineNumbers
```

**What:** Declares the `pools` internal helper package.

**How:** Called by the ingest decoder when it receives Orca program-owned account updates.

**Why:** Parsing raw bytes is DEX-specific and should remain in an internal, well-reviewed location.

### imports

```go title="imports" file=<rootDir>/ingestor/internal/pools/orca.go#L3-L8 showLineNumbers
```

**What:** Dependencies for parsing and base58-encoding extracted pubkeys.

**How:** `encoding/binary` reads little-endian integers (fee rates), `base58` encodes 32-byte pubkeys into strings, and `fmt` formats descriptive errors.

**Why:** These helpers are performance-sensitive and keep dependencies minimal.

### const (orcaConfigOffset, orcaDiscriminatorLen, orcaFeeGrowthAOffset, orcaFeeRateOffset, orcaLiquidityOffset, orcaProtocolFeeAOOffset, orcaProtocolFeeBOOffset, orcaProtocolFeeOffset, orcaRequiredLength, orcaSqrtPriceOffset, orcaTickOffset, orcaTokenMintAOffset, orcaTokenMintBOffset, orcaTokenVaultAOffset, orcaTokenVaultBOffset)

**Symbols:** orcaConfigOffset, orcaDiscriminatorLen, orcaFeeGrowthAOffset, orcaFeeRateOffset, orcaLiquidityOffset, orcaProtocolFeeAOOffset, orcaProtocolFeeBOOffset, orcaProtocolFeeOffset, orcaRequiredLength, orcaSqrtPriceOffset, orcaTickOffset, orcaTokenMintAOffset, orcaTokenMintBOffset, orcaTokenVaultAOffset, orcaTokenVaultBOffset

```go title="const (orcaConfigOffset, orcaDiscriminatorLen, orcaFeeGrowthAOffset, orcaFeeRateOffset, orcaLiquidityOffset, orcaProtocolFeeAOOffset, orcaProtocolFeeBOOffset, orcaProtocolFeeOffset, orcaRequiredLength, orcaSqrtPriceOffset, orcaTickOffset, orcaTokenMintAOffset, orcaTokenMintBOffset, orcaTokenVaultAOffset, orcaTokenVaultBOffset)" file=<rootDir>/ingestor/internal/pools/orca.go#L10-L26 showLineNumbers
```

**What:** Hard-coded offsets and minimum lengths for the Whirlpool account layout.

**How:** The constants compute offsets for fields like:

- config pubkey
- fee rate and protocol fee rate
- token mint A/B and vault A/B pubkeys

`orcaRequiredLength` is the minimum number of bytes required to safely slice all fields used by `DecodeOrcaPool`.

**Why:** The decoder parses raw bytes by slicing. Explicit offsets + bounds checks prevent panics and make layout assumptions reviewable.

### type (OrcaPoolInfo)

**Symbols:** OrcaPoolInfo

```go title="type (OrcaPoolInfo)" file=<rootDir>/ingestor/internal/pools/orca.go#L28-L37 showLineNumbers
```

**What:** Minimal metadata needed to decode Orca swaps from balance deltas.

**How:** Stores:

- `FeeRate` (hundredths of a basis point) and `ProtocolFee`
- token mint A/B pubkeys
- token vault A/B pubkeys
- the pool config pubkey

All pubkeys are stored as base58 strings for stable map keys and logging.

**Why:** The swap decoder needs to know which mints/vaults correspond to the pool and what fee rate to attach to emitted events.

### func DecodeOrcaPool

**Symbols:** DecodeOrcaPool

```go title="func DecodeOrcaPool" file=<rootDir>/ingestor/internal/pools/orca.go#L39-L54 showLineNumbers
```

**What:** Extracts `OrcaPoolInfo` from raw whirlpool account bytes.

**How:** Validates the data length, then slices and decodes fields at fixed offsets:

- pubkey fields are base58-encoded from 32-byte slices
- fee fields are parsed using little-endian uint16 reads

**Why:** Account update streams provide raw bytes; decoding them into a typed struct allows the higher-level swap decoder to produce correct canonical events without embedding byte offsets in multiple places.

:::note
This function assumes the caller has already identified the account type by context (e.g. “account owner is Orca Whirlpool program”). It does not currently validate the discriminator bytes itself.
:::
